var AlkkagiSharedBundle=(()=>{var $=Object.defineProperty;var _t=Object.getOwnPropertyDescriptor;var Mt=Object.getOwnPropertyNames;var Rt=Object.prototype.hasOwnProperty;var Vt=(r,t,e)=>t in r?$(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Nt=(r,t)=>{for(var e in t)$(r,e,{get:t[e],enumerable:!0})},Wt=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Mt(t))!Rt.call(r,s)&&s!==e&&$(r,s,{get:()=>t[s],enumerable:!(i=_t(t,s))||i.enumerable});return r};var qt=r=>Wt($({},"__esModule",{value:!0}),r);var z=(r,t,e)=>Vt(r,typeof t!="symbol"?t+"":t,e);var Kt={};Nt(Kt,{BuffData:()=>M,BufferReadHandle:()=>v,BufferWriteHandle:()=>L,C2S_BuyItemPacket:()=>J,C2S_CharacterStatLevelUpRequestPacket:()=>mt,C2S_EnterWorldRequestPacket:()=>H,C2S_FinishAttackChargingPacket:()=>rt,C2S_InteractAbilityContainerRequestPacket:()=>ut,C2S_InteractAbilityEvolutionContainerRequestPacket:()=>ht,C2S_MoveInputPacket:()=>et,C2S_StartAttackChargingPacket:()=>it,CharacterEntityDynamicData:()=>w,CharacterEntityStaticData:()=>I,DamagableEntityDynamicData:()=>b,EAbilityType:()=>X,EBuffType:()=>Xt,EEntityType:()=>c,ELogLevel:()=>R,ELogMode:()=>V,EMoveInput:()=>j,EPacketID:()=>n,EStatLevelUpType:()=>y,EntityDataFactory:()=>p,EntityDynamicData:()=>C,EntityStaticData:()=>F,MessagePacket:()=>Z,Packet:()=>o,PacketHandler:()=>K,PacketManager:()=>T,PlayerEntityDynamicData:()=>k,PlayerEntityStaticData:()=>O,Random:()=>dt,ResourceAbilityInfo:()=>G,ResourceBase:()=>D,ResourceCharacterLevel:()=>Ut,ResourceShopItem:()=>Pt,ResourceStatLevelUp:()=>wt,S2C_AddBuffPacket:()=>Ft,S2C_AddPlayerPacket:()=>at,S2C_CharacterLevelUpPacket:()=>st,S2C_CharacterStatLevelUpResponsePacket:()=>ot,S2C_EnterWorldResponsePacket:()=>tt,S2C_InformCharacterAbilityChangedPacket:()=>pt,S2C_InteractAbilityContainerResponsePacket:()=>ft,S2C_InteractAbilityEvolutionContainerResponsePacket:()=>ct,S2C_RemoveBuffPacket:()=>It,S2C_RemovePlayerPacket:()=>lt,S2C_UpdateRankingPacket:()=>nt,S2C_UpdateWorldPacket:()=>Y,SerializableData:()=>x,StatConfig:()=>d,StaticEntityStaticData:()=>g,Vector:()=>h,VectorPacket:()=>Q,WorldPlayerData:()=>E,XPContainerEntityStaticData:()=>_,XPObjectEntityStaticData:()=>B,decodeUTF16LE:()=>zt,decodeUTF8:()=>yt,encodeUTF16LE:()=>St,encodeUTF8:()=>Dt,getBytesHeaderSize:()=>m,getFlexiableUTF16LESize:()=>$t,getFlexiableUTF8Size:()=>A,logger:()=>jt,parseToBoolean:()=>q,parseToFloat:()=>N,parseToInteger:()=>W});var P={WEIGHT:0,MAX_HP:1,ATK_COOLTIME:2,POWER:3,MOVE_SPEED:4,AUTO_HEAL:5},Gt={[P.WEIGHT]:1.5,[P.MAX_HP]:100,[P.ATK_COOLTIME]:2,[P.POWER]:20,[P.MOVE_SPEED]:4,[P.AUTO_HEAL]:.5},d={Type:P,DefaultValue:Gt};function Dt(r){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(r);let t=[];for(let e=0;e<r.length;e++){let i=r.charCodeAt(e);if(i>=55296&&i<=56319&&e+1<r.length){let s=r.charCodeAt(e+1);s>=56320&&s<=57343&&(i=65536+(i-55296<<10)+(s-56320),e++)}i<=127?t.push(i):i<=2047?t.push(192|i>>6,128|i&63):i<=65535?t.push(224|i>>12,128|i>>6&63,128|i&63):t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}return Uint8Array.from(t)}function yt(r){var e,i,s,a,l,u;if(typeof TextDecoder!="undefined")return new TextDecoder("utf-8").decode(r);let t="";for(let f=0;f<r.length;){let S=r[f++];if(S<128){t+=String.fromCharCode(S);continue}if((S&224)===192){let xt=((e=r[f++])!=null?e:0)&63,gt=(S&31)<<6|xt;t+=String.fromCharCode(gt);continue}if((S&240)===224){let xt=((i=r[f++])!=null?i:0)&63,gt=((s=r[f++])!=null?s:0)&63,Bt=(S&15)<<12|xt<<6|gt;t+=String.fromCharCode(Bt);continue}let At=((a=r[f++])!=null?a:0)&63,kt=((l=r[f++])!=null?l:0)&63,vt=((u=r[f++])!=null?u:0)&63,Tt=(S&7)<<18|At<<12|kt<<6|vt,Lt=55296+(Tt-65536>>10),Ot=56320+(Tt-65536&1023);t+=String.fromCharCode(Lt,Ot)}return t}function St(r,t=!1){let e=[];for(let l=0;l<r.length;l++){let u=r.charCodeAt(l);if(u>=55296&&u<=56319&&l+1<r.length){let f=r.charCodeAt(l+1);if(f>=56320&&f<=57343){e.push(u,f),l++;continue}}e.push(u)}let i=t?2:0,s=new Uint8Array(e.length*2+i),a=0;t&&(s[a++]=255,s[a++]=254);for(let l=0;l<e.length;l++){let u=e[l];s[a++]=u&255,s[a++]=u>>8}return s}function zt(r){let t=0;r.length>=2&&r[0]===255&&r[1]===254&&(t=2);let e=32768,i=r.length-t>>>1,s="";for(let a=0;a<i;a+=e){let l=Math.min(e,i-a),u=new Array(l);for(let f=0;f<l;f++)u[f]=r[t+(a+f<<1)]|r[t+(a+f<<1)+1]<<8;s+=String.fromCharCode(...u)}return s}var v=class{constructor(t){this.buffer=t,this.view=new DataView(t),this.offset=0}readUint8(){if(this.offset+1>this.buffer.byteLength)throw new Error("Error with readUint8: Out of bounds");let t=this.view.getUint8(this.offset);return this.offset+=1,t}readUint16(){if(this.offset+2>this.buffer.byteLength)throw new Error("Error with readUint16: Out of bounds");let t=this.view.getUint16(this.offset,!0);return this.offset+=2,t}readUint32(){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with readUint32: Out of bounds");let t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}readInt8(){if(this.offset+1>this.buffer.byteLength)throw new Error("Error with readInt8: Out of bounds");let t=this.view.getInt8(this.offset);return this.offset+=1,t}readInt16(){if(this.offset+2>this.buffer.byteLength)throw new Error("Error with readInt16: Out of bounds");let t=this.view.getInt16(this.offset,!0);return this.offset+=2,t}readInt32(){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with readInt32: Out of bounds");let t=this.view.getInt32(this.offset,!0);return this.offset+=4,t}readFloat32(){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with readFloat32: Out of bounds");let t=this.view.getFloat32(this.offset,!0);return this.offset+=4,t}readFloat64(){if(this.offset+8>this.buffer.byteLength)throw new Error("Error with readFloat64: Out of bounds");let t=this.view.getFloat64(this.offset,!0);return this.offset+=8,t}readStringUTF8(){let t=this.readUint16();if(this.offset+t>this.buffer.byteLength)throw new Error("Error with readStringUTF8: Out of bounds");let e=new Uint8Array(this.buffer,this.offset,t),i=yt(e);return this.offset+=t,i}readStringUTF16LE(){let t=this.readUint16();if(this.offset+t>this.buffer.byteLength)throw new Error("Error with readStringUTF16LE: Out of bounds");let e=new Uint8Array(this.buffer,this.offset,t),i=zt(e);return this.offset+=t,i}readBytes(){return new Uint8Array(this.readArrayBuffer())}readArrayBuffer(){let t=this.readUint16();if(this.offset+t>this.buffer.byteLength)throw new Error("Error with readArrayBuffer: Out of bounds");let e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}},L=class{constructor(t){this.buffer=t,this.view=new DataView(t),this.offset=0}writeUint8(t){if(this.offset+1>this.buffer.byteLength)throw new Error("Error with writeUint8: Out of bounds");this.view.setUint8(this.offset,t),this.offset+=1}writeUint16(t){if(this.offset+2>this.buffer.byteLength)throw new Error("Error with writeUint16: Out of bounds");this.view.setUint16(this.offset,t,!0),this.offset+=2}writeUint32(t){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with writeUint32: Out of bounds");this.view.setUint32(this.offset,t,!0),this.offset+=4}writeInt8(t){if(this.offset+1>this.buffer.byteLength)throw new Error("Error with writeInt8: Out of bounds");this.view.setInt8(this.offset,t),this.offset+=1}writeInt16(t){if(this.offset+2>this.buffer.byteLength)throw new Error("Error with writeInt16: Out of bounds");this.view.setInt16(this.offset,t,!0),this.offset+=2}writeInt32(t){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with writeInt32: Out of bounds");this.view.setInt32(this.offset,t,!0),this.offset+=4}writeFloat32(t){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with writeFloat32: Out of bounds");this.view.setFloat32(this.offset,t,!0),this.offset+=4}writeFloat64(t){if(this.offset+8>this.buffer.byteLength)throw new Error("Error with writeFloat64: Out of bounds");this.view.setFloat64(this.offset,t,!0),this.offset+=8}writeStringUTF8(t){let e=Dt(t),i=e.length;if(i>65535)throw new Error("Error with writeStringUTF8: Out of bounds");if(this.offset+2+i>this.buffer.byteLength)throw new Error("Error with writeStringUTF8: Out of bounds");this.writeUint16(i),new Uint8Array(this.buffer,this.offset,i).set(e),this.offset+=i}writeStringUTF16LE(t){let e=St(t,!1),i=e.length;if(i>65535)throw new Error("Error with writeStringUTF16LE: Out of bounds");if(this.offset+2+i>this.buffer.byteLength)throw new Error("Error with writeStringUTF16LE: Out of bounds");this.writeUint16(i),new Uint8Array(this.buffer,this.offset,i).set(e),this.offset+=i}writeBytes(t){let e=t.length;if(this.offset+e>this.buffer.byteLength)throw new Error("Error with writeBytes: Out of bounds");this.writeUint16(e),new Uint8Array(this.buffer,this.offset,e).set(t),this.offset+=e}writeArrayBuffer(t){let e=new Uint8Array(t);this.writeBytes(e)}build(){return this.buffer.slice(0,this.offset)}};function A(r){return 2+r.length*4}function $t(r){return 2+r.length*4}function m(){return 2}var x=class{constructor(){}getFlexibleSize(){throw new Error("Abstract method 'getFlexiableSize' must be implemented")}serialize(){let t=new ArrayBuffer(this.getFlexibleSize()),e=new L(t);return this.onSerialize(e),e.build()}onSerialize(t){throw new Error("Abstract method 'onSerialize' must be implemented")}deserialize(t){let e=new v(t);return this.onDeserialize(e),this}onDeserialize(t){throw new Error("Abstract method 'onDeserialize' must be implemented")}};var c={None:0,XPObject:1,XPContainer:2,GoldContainer:3,Player:4,BotPlayer:5,AbilityContainer:6,AbilityEvolutionContainer:7};var C=class extends x{constructor(t){var e,i;super(),this.entityType=(e=t==null?void 0:t.getEntityType())!=null?e:c.None,this.entityID=(i=t==null?void 0:t.getID())!=null?i:0}getFlexibleSize(){let t=0;return t+=4,t}onSerialize(t){t.writeUint32(this.entityID)}onDeserialize(t){this.entityID=t.readUint32()}};var b=class extends C{constructor(t){var s;super(t);let e=(s=t==null?void 0:t.healthComponent)!=null?s:void 0,i=(e?e.currentHP/e.maxHPProvider():0)*100;this.hpPer=Math.round(i)}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.hpPer)}onDeserialize(t){super.onDeserialize(t),this.hpPer=t.readUint8()}};var h=class r extends x{static Zero(){return new r(0,0)}static One(){return new r(1,1)}static Up(){return new r(0,1)}static Down(){return new r(0,-1)}static Left(){return new r(-1,0)}static Right(){return new r(1,0)}constructor(t=0,e=0){super(),this.x=t,this.y=e}set(t,e){this.x=t,this.y=e}getFlexibleSize(){let t=0;return t+=4,t+=4,t}onSerialize(t){t.writeFloat32(this.x),t.writeFloat32(this.y)}onDeserialize(t){this.x=t.readFloat32(),this.y=t.readFloat32()}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}getSqrMagnitude(){return this.x*this.x+this.y*this.y}normalize(){let t=this.getSqrMagnitude();if(t===0)return this;let e=1/Math.sqrt(t);return this.x*=e,this.y*=e,this}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t,this.y/=t,this}static equals(t,e){return t.x===e.x&&t.y===e.y}static normalize(t){let e=t.getSqrMagnitude();if(e===0)return new r(0,0);let i=1/Math.sqrt(e);return new r(t.x*i,t.y*i)}static add(t,e){return new r(t.x+e.x,t.y+e.y)}static subtract(t,e){return new r(t.x-e.x,t.y-e.y)}static multiply(t,e){return new r(t.x*e,t.y*e)}static divide(t,e){return new r(t.x/e,t.y/e)}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}};var w=class extends b{constructor(t){var e,i;super(t),this.position=(e=t==null?void 0:t.position)!=null?e:new h,this.scale=(i=t==null?void 0:t.scale)!=null?i:1}getFlexibleSize(){let t=super.getFlexibleSize();return t+=this.position.getFlexibleSize()+m(),t+=4,t}onSerialize(t){super.onSerialize(t),t.writeArrayBuffer(this.position.serialize()),t.writeFloat32(this.scale)}onDeserialize(t){super.onDeserialize(t),this.position=new h().deserialize(t.readArrayBuffer()),this.scale=t.readFloat32()}};var F=class extends x{constructor(t){var e,i;super(),this.entityType=(e=t==null?void 0:t.getEntityType())!=null?e:c.None,this.entityID=(i=t==null?void 0:t.getID())!=null?i:0}getFlexibleSize(){let t=0;return t+=4,t}onSerialize(t){t.writeUint32(this.entityID)}onDeserialize(t){this.entityID=t.readUint32()}};var I=class extends F{constructor(t){var e,i,s,a,l;super(t),this.position=(e=t==null?void 0:t.position)!=null?e:new h,this.scale=(i=t==null?void 0:t.scale)!=null?i:1,this.abilityID=(l=(a=(s=t==null?void 0:t.abilityComponent)==null?void 0:s.ability)==null?void 0:a.abilityID)!=null?l:""}getFlexibleSize(){let t=super.getFlexibleSize();return t+=this.position.getFlexibleSize()+m(),t+=4,t+=1,t}onSerialize(t){super.onSerialize(t),t.writeArrayBuffer(this.position.serialize()),t.writeFloat32(this.scale),t.writeUint8(this.abilityID)}onDeserialize(t){super.onDeserialize(t),this.position=new h().deserialize(t.readArrayBuffer()),this.scale=t.readFloat32(),this.abilityID=t.readUint8()}};var X={None:0};var Xt={MoveSpeedPer:0,Shield:1,DamagePer:2};var j={None:0,Up:1,Down:2,Left:3,Right:4,UpLeft:5,UpRight:6,DownLeft:7,DownRight:8};var g=class extends F{constructor(t){var e,i;super(t),this.position=(e=t==null?void 0:t.position)!=null?e:new h,this.scale=(i=t==null?void 0:t.scale)!=null?i:1}getFlexibleSize(){let t=super.getFlexibleSize();return t+=this.position.getFlexibleSize()+m(),t+=4,t}onSerialize(t){super.onSerialize(t),t.writeArrayBuffer(this.position.serialize()),t.writeFloat32(this.scale)}onDeserialize(t){super.onDeserialize(t),this.position=new h().deserialize(t.readArrayBuffer()),this.scale=t.readFloat32()}};var k=class extends w{constructor(t){var e,i,s;super(t),this.entityType=c.Player,this.exp=(i=(e=t==null?void 0:t.levelComponent)==null?void 0:e.xpAmount)!=null?i:0,this.score=(s=t==null?void 0:t.score)!=null?s:0}getFlexibleSize(){let t=super.getFlexibleSize();return t+=2,t+=2,t}onSerialize(t){super.onSerialize(t),t.writeUint16(this.exp),t.writeUint16(this.score)}onDeserialize(t){super.onDeserialize(t),this.exp=t.readUint16(),this.score=t.readUint16()}};var O=class extends I{constructor(t){super(t),this.entityType=c.Player}getFlexibleSize(){return super.getFlexibleSize()}onSerialize(t){super.onSerialize(t)}onDeserialize(t){super.onDeserialize(t)}};var B=class extends g{constructor(t){var e,i;super(t),this.xpAmount=(e=t==null?void 0:t.xpAmount)!=null?e:0,this.lifeTime=(i=t==null?void 0:t.lifeTime)!=null?i:0}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.xpAmount),t.writeUint8(this.lifeTime)}onDeserialize(t){super.onDeserialize(t),this.xpAmount=t.readUint8(),this.lifeTime=t.readUint8()}};var _=class extends g{constructor(t){var e;super(t),this.xpUnit=(e=t==null?void 0:t.xpUnit)!=null?e:0}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.xpUnit)}onDeserialize(t){super.onDeserialize(t),this.xpUnit=t.readUint8()}};var U=class U{constructor(){throw new Error("EntityDataFactory is a static class and cannot be instantiated")}static on(t,e,i){U.entityStaticDataFactories[t]=e,U.entityDynamicDataFactories[t]=i}static createEntityStaticData(t,e){if(t==c.None)throw new Error("Entity type is not set");let i=U.entityStaticDataFactories[t];return i==null?null:new i(e)}static createEntityDynamicData(t,e){if(t==c.None)throw new Error("Entity type is not set");let i=U.entityDynamicDataFactories[t];return i==null?null:new i(e)}};z(U,"entityStaticDataFactories",{}),z(U,"entityDynamicDataFactories",{});var p=U;p.on(c.XPObject,B,null);p.on(c.XPContainer,_,b);p.on(c.GoldContainer,g,b);p.on(c.Player,O,k);p.on(c.BotPlayer,I,w);p.on(c.AbilityContainer,g,null);p.on(c.AbilityEvolutionContainer,g,null);var M=class extends x{constructor(t,e,i){this.type=t,this.time=e,this.value=i}getFlexibleSize(){let t=0;return t+=1,t+=4,t+=4,t}onSerialize(t){t.writeUint8(this.type),t.writeFloat32(this.time),t.writeFloat32(this.value)}onDeserialize(t){this.type=t.readUint8(),this.time=t.readFloat32(),this.value=t.readFloat32()}};var Ct={ERROR:"\x1B[31m",WARN:"\x1B[33m",INFO:"\x1B[36m",DEBUG:"\x1B[90m",RESET:"\x1B[0m"},R={ERROR:0,WARN:1,INFO:2,DEBUG:3},V={DEVELOPMENT:"development",PRODUCTION:"production",MASTER:"master"},bt={[V.DEVELOPMENT]:R.DEBUG,[V.PRODUCTION]:R.INFO,[V.MASTER]:R.ERROR},Et=class{constructor(){this.currentLevel=bt[V.DEVELOPMENT]}setMode(t){bt.hasOwnProperty(t)!==!1&&(this.currentLevel=bt[t])}getTimestamp(){return new Date().toISOString()}formatMessage(t,e,i){let s=this.getTimestamp(),a=Ct[t]||"",l=Ct.RESET;return`${a}[${s}] [${t}] [${e}] ${i}${l}`}log(t,e,i){R[t]>this.currentLevel||console.log(this.formatMessage(t,e,i))}error(t,e){this.log("ERROR",t,e)}warn(t,e){this.log("WARN",t,e)}info(t,e){this.log("INFO",t,e)}debug(t,e){this.log("DEBUG",t,e)}},jt=new Et;var dt=class r{constructor(){throw new Error("Random is a static class and cannot be instantiated")}static direction(){let t=Math.random()*2*Math.PI;return new h(Math.cos(t),Math.sin(t))}static insideUnitCircle(){return r.direction().multiply(Math.random())}static range(t,e){return Math.random()*(e-t)+t}static rangeInt(t,e){return Math.floor(r.range(t,e))}};var E=class extends x{constructor(t){var e,i;super(),this.entityID=(e=t==null?void 0:t.getID())!=null?e:0,this.name=(i=t==null?void 0:t.nickname)!=null?i:""}getFlexibleSize(){let t=0;return t+=4,t+=A(this.name),t}onSerialize(t){t.writeUint32(this.entityID),t.writeStringUTF8(this.name)}onDeserialize(t){this.entityID=t.readUint32(),this.name=t.readStringUTF8()}};var o=class extends x{constructor(){super()}getPacketID(){throw new Error("Abstract method 'getPacketID' must be implemented")}getFlexibleSize(){let t=0;return t+=1,t}onSerialize(t){t.writeUint8(this.getPacketID())}onDeserialize(t){t.readUint8()}};var K=class{constructor(){}handle(t){throw new Error("Abstract method 'handle' must be implemented")}};var T=class{constructor(){throw new Error("PacketManager is a static class and cannot be instantiated")}static on(t,e,i){this.factories[t]=e,this.handlers[t]=i}static createPacket(t,e){let i=this.factories[t];if(i===void 0)throw new Error(`Factory for packetID ${t} not found`);let s=new i;return s.deserialize(e),s}static createHandler(t,...e){let i=this.handlers[t];if(i===void 0)throw new Error(`Handler for packetID ${t} not found`);return new i(...this.handlerArgs,...e)}static injectHandlerArgs(...t){this.handlerArgs=t}};z(T,"factories",{}),z(T,"handlers",{}),z(T,"handlerArgs",[]);var n={Message:0,Vector:1,S2C_UpdateWorld:2,C2S_EnterWorldRequest:3,S2C_EnterWorldResponse:4,C2S_MoveInput:5,C2S_StartAttackCharging:6,C2S_FinishAttackCharging:7,C2S_BuyItem:8,S2C_CharacterLevelUp:9,C2S_CharacterStatLevelUpRequest:10,S2C_CharacterStatLevelUpResponse:11,S2C_UpdateRankingPacket:12,S2C_AddPlayerPacket:13,S2C_RemovePlayerPacket:14,S2C_AddBuffPacket:15,S2C_RemoveBuffPacket:16,C2S_InteractAbilityContainerRequestPacket:17,S2C_InteractAbilityContainerResponsePacket:18,C2S_InteractAbilityEvolutionContainerRequestPacket:19,S2C_InteractAbilityEvolutionContainerResponsePacket:20,S2C_InformCharacterAbilityChangedPacket:21};var J=class extends o{constructor(t=0){super(),this.buyItemId=t}getPacketID(){return n.C2S_BuyItem}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.buyItemId)}onDeserialize(t){super.onDeserialize(t),this.buyItemId=t.readUint8()}};function N(r){if(r==null)return null;let t=String(r).trim().replace(",","."),e=Number.parseFloat(t);return Number.isFinite(e)?e:null}function W(r){if(r==null)return null;let t=Number.parseInt(String(r).trim(),10);return Number.isFinite(t)?t:null}function q(r){if(r==null)return null;let t=String(r).trim().toLowerCase();return t==="true"||t==="1"?!0:t==="false"||t==="0"?!1:null}var D=class{constructor(){this.id=0,this.name="",this.desc="",this.dict={}}init(t,e){this.id=t,this.dict=e||{},this.name=this.getDictValue("Name",""),this.desc=this.getDictValue("Desc","")}hasDict(t){return Object.prototype.hasOwnProperty.call(this.dict,t)}getDictValue(t,e=""){return this.dict[t]}getDictValueInt(t,e=0){let i=W(this.dict[t]);return Number.isFinite(i)?i:e}getDictValueFloat(t,e=0){let i=N(this.dict[t]);return Number.isFinite(i)?i:e}getDictValueBool(t,e=!1){let i=q(this.dict[t]);return i==null?e:!!i}getDictValueArray(t,e=[]){let i=this.dict[t];if(i==null)return e;if(Array.isArray(i))return i;if(typeof i=="string"){try{let a=JSON.parse(i);if(Array.isArray(a))return a}catch(a){}let s=i.split(",").map(a=>a.trim()).filter(a=>a.length>0);if(s.length>0)return s}return e}static _ensureStore(){Object.prototype.hasOwnProperty.call(this,"items")||Object.defineProperty(this,"items",{value:new Map,writable:!0,enumerable:!1,configurable:!0})}static get(t){return this._ensureStore(),this.items.get(t)}static getAll(){return this._ensureStore(),this.items}static getWhere(t){this._ensureStore();let e=[];for(let i of this.items.values())(!t||t(i))&&e.push(i);return e}static async load(t,e=!0){let i=this;i._ensureStore();let s;try{let a=t.charCodeAt(0)===65279?t.slice(1):t;s=JSON.parse(a)}catch(a){throw new Error(`[${i.name}] JSON parse error`)}e&&i.items.clear();for(let a in s){if(!Object.prototype.hasOwnProperty.call(s,a))continue;let l=Number.parseInt(a,10);if(!Number.isFinite(l))continue;let u=s[a],f=u;if(typeof u=="string")try{f=JSON.parse(u)}catch(At){throw new Error(`[${i.name}] Skip id=${l} (inner JSON parse error)`)}if(!f||typeof f!="object")throw new Error(`[${i.name}] Skip id=${l} (value is not an object)`);let S=new i;S.init(l,f),i.items.set(l,S)}}};var y={ADD_WEIGHT:1,ADD_POWER:2,ADD_MAX_HP:3,ADD_MOVE_SPEED:4,REDUCE_ATK_COOLTIME:5,AUTO_HEAL:6},wt=class extends D{constructor(){super(),this.icon="",this.levelUpEffect="",this.maxLevel=0,this.isPercentage=!1,this.levelValues=[]}init(t,e){super.init(t,e),this.icon=this.getDictValue("Icon",""),this.levelUpEffect=this.getDictValue("LevelUpEffect",""),this.maxLevel=this.getDictValueInt("MaxLevel",0),this.isPercentage=this.getDictValueBool("IsPercentage",!1),this.levelValues=this.getDictValue("LevelValues")}getLevelValue(t){if(t>this.maxLevel)throw new Error("Invalid level exception");return this.levelValues[t]}static getByStatType(t){switch(t){case d.Type.WEIGHT:return this.get(y.ADD_WEIGHT);case d.Type.MAX_HP:return this.get(y.ADD_MAX_HP);case d.Type.ATK_COOLTIME:return this.get(y.REDUCE_ATK_COOLTIME);case d.Type.AUTO_HEAL:return this.get(y.AUTO_HEAL);case d.Type.POWER:return this.get(y.ADD_POWER);case d.Type.MOVE_SPEED:return this.get(y.ADD_MOVE_SPEED);default:return null}}};var Z=class extends o{constructor(t=""){super(),this.message=t}getPacketID(){return n.Message}getFlexibleSize(){let t=super.getFlexibleSize();return t+=A(this.message),t}onSerialize(t){super.onSerialize(t),t.writeStringUTF8(this.message)}onDeserialize(t){super.onDeserialize(t),this.message=t.readStringUTF8()}};var Q=class extends o{constructor(t=new h){super(),this.vector=t}getPacketID(){return n.Vector}getFlexibleSize(){let t=super.getFlexibleSize();return t+=this.vector.getFlexibleSize()+m(),t}onSerialize(t){super.onSerialize(t),t.writeArrayBuffer(this.vector.serialize())}onDeserialize(t){super.onDeserialize(t),this.vector=new h().deserialize(t.readArrayBuffer())}};var Y=class extends o{constructor(t=0,e=null,i=[],s=[],a=[]){super(),this.elapsedMS=t,this.appearedEntityStaticDataSize=0,this.appearedEntityStaticDatas=[],i.forEach(l=>{let u=this._createEntityData(e,l,p.createEntityStaticData);u!=null&&(this.appearedEntityStaticDataSize+=u.dataSize,this.appearedEntityStaticDatas.push(u.entityData))}),this.nearbyEntityDynamicDataSize=0,this.nearbyEntityDynamicDatas=[],s.forEach(l=>{let u=this._createEntityData(e,l,p.createEntityDynamicData);u!=null&&(this.nearbyEntityDynamicDataSize+=u.dataSize,this.nearbyEntityDynamicDatas.push(u.entityData))}),this.disappearedEntityIDs=[],a.forEach(l=>{this.disappearedEntityIDs.push(l.entityID)})}_createEntityData(t,e,i){let s=t!=null&&e.entityID==t.entityID?c.Player:e.getEntityType(),a=i(s,e);return a==null?null:{dataSize:a.getFlexibleSize()+m()+1,entityData:a}}getPacketID(){return n.S2C_UpdateWorld}getFlexibleSize(){let t=super.getFlexibleSize();return t+=2,t+=this.appearedEntityStaticDataSize+2,t+=this.nearbyEntityDynamicDataSize+2,t+=this.disappearedEntityIDs.length*4+2,t}onSerialize(t){super.onSerialize(t),t.writeUint16(this.elapsedMS),this._writeEntityDatas(t,this.appearedEntityStaticDatas),this._writeEntityDatas(t,this.nearbyEntityDynamicDatas),t.writeUint16(this.disappearedEntityIDs.length);for(let e=0;e<this.disappearedEntityIDs.length;++e)t.writeUint32(this.disappearedEntityIDs[e])}onDeserialize(t){super.onDeserialize(t),this.elapsedMS=t.readUint16(),this._readEntityDatas(t,p.createEntityStaticData,this.appearedEntityStaticDatas),this._readEntityDatas(t,p.createEntityDynamicData,this.nearbyEntityDynamicDatas);let e=t.readUint16();for(let i=0;i<e;++i)this.disappearedEntityIDs.push(t.readUint32())}_writeEntityDatas(t,e){t.writeUint16(e.length);for(let i=0;i<e.length;++i){let s=e[i];t.writeUint8(s.entityType),t.writeArrayBuffer(s.serialize())}}_readEntityDatas(t,e,i){let s=t.readUint16();for(let a=0;a<s;++a){let l=t.readUint8(),u=e(l,null);if(u==null)return;u.deserialize(t.readArrayBuffer()),u.entityType=l,i.push(u)}}};var H=class extends o{constructor(t,e){super(),this.nickname=t,this.isMobile=e}getPacketID(){return n.C2S_EnterWorldRequest}getFlexibleSize(){let t=super.getFlexibleSize();return t+=A(this.nickname),t+=getUint8Size(this.isMobile),t}onSerialize(t){super.onSerialize(t),t.writeStringUTF8(this.nickname),t.writeUint8(this.isMobile)}onDeserialize(t){super.onDeserialize(t),this.nickname=t.readStringUTF8(),this.isMobile=t.readUint8()}};var tt=class extends o{constructor(t=0,e=[],i=new h){super(),this.entityID=t,this.worldPlayerData=[];for(let s of e)this.worldPlayerData.push(new E(s));this.viewSize=i}getPacketID(){return n.S2C_EnterWorldResponse}getFlexibleSize(){let t=super.getFlexibleSize();t+=4,t+=4;for(let e of this.worldPlayerData)t+=e.getFlexibleSize();return t+=this.viewSize.getFlexibleSize()+m(),t}onSerialize(t){super.onSerialize(t),t.writeUint32(this.entityID),t.writeUint32(this.worldPlayerData.length);for(let e of this.worldPlayerData)t.writeArrayBuffer(e.serialize());t.writeArrayBuffer(this.viewSize.serialize())}onDeserialize(t){super.onDeserialize(t),this.entityID=t.readUint32();let e=t.readUint32();this.worldPlayerData=[];for(let i=0;i<e;i++)this.worldPlayerData.push(new E().deserialize(t.readArrayBuffer()));this.viewSize=new h().deserialize(t.readArrayBuffer())}};var et=class extends o{constructor(t=j.None){super(),this.moveInput=t}getPacketID(){return n.C2S_MoveInput}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.moveInput)}onDeserialize(t){super.onDeserialize(t),this.moveInput=t.readUint8()}};var it=class extends o{constructor(){super()}getPacketID(){return n.C2S_StartAttackCharging}getFlexibleSize(){return super.getFlexibleSize()}onSerialize(t){super.onSerialize(t)}onDeserialize(t){super.onDeserialize(t)}};var rt=class extends o{constructor(t=h.Zero()){super(),this.direction=t}getPacketID(){return n.C2S_FinishAttackCharging}getFlexibleSize(){let t=super.getFlexibleSize();return t+=this.direction.getFlexibleSize()+m(),t}onSerialize(t){super.onSerialize(t),t.writeArrayBuffer(this.direction.serialize())}onDeserialize(t){super.onDeserialize(t),this.direction=new h().deserialize(t.readArrayBuffer())}};var st=class extends o{constructor(t=0,e=0){super(),this.currentLevel=t,this.currentStatPoint=e}getPacketID(){return n.S2C_CharacterLevelUp}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.currentLevel),t.writeUint8(this.currentStatPoint)}onDeserialize(t){super.onDeserialize(t),this.currentLevel=t.readUint8(),this.currentStatPoint=t.readUint8()}};var ot=class extends o{constructor(t=y.ADD_WEIGHT,e=0,i=0){super(),this.statType=t,this.statLevel=e,this.statPoint=i}getPacketID(){return n.S2C_CharacterStatLevelUpResponse}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t+=1,t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.statType),t.writeUint8(this.statLevel),t.writeUint8(this.statPoint)}onDeserialize(t){super.onDeserialize(t),this.statType=t.readUint8(),this.statLevel=t.readUint8(),this.statPoint=t.readUint8()}};var nt=class extends o{constructor(t=[]){super(),this.rankingPlayerIds=[],this.rankingPlayerScores=[],t.forEach(e=>{this.rankingPlayerIds.push(e.entityID),this.rankingPlayerScores.push(e.score)})}getPacketID(){return n.S2C_UpdateRankingPacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t+=this.rankingPlayerIds.length*6,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.rankingPlayerIds.length);for(let e=0;e<this.rankingPlayerIds.length;++e)t.writeUint32(this.rankingPlayerIds[e]),t.writeUint16(this.rankingPlayerScores[e])}onDeserialize(t){super.onDeserialize(t);let e=t.readUint8();for(let i=0;i<e;++i){let s=t.readUint32(),a=t.readUint16();this.rankingPlayerIds.push(s),this.rankingPlayerScores.push(a)}}};var at=class extends o{constructor(t){super(),this.addPlayerData=new E(t)}getPacketID(){return n.S2C_AddPlayerPacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=this.addPlayerData.getFlexibleSize(),t}onSerialize(t){super.onSerialize(t),t.writeArrayBuffer(this.addPlayerData.serialize())}onDeserialize(t){super.onDeserialize(t),this.addPlayerData=new E().deserialize(t.readArrayBuffer())}};var lt=class extends o{constructor(t){super(),this.removePlayerEntityID=t}getPacketID(){return n.S2C_RemovePlayerPacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=4,t}onSerialize(t){super.onSerialize(t),t.writeUint32(this.removePlayerEntityID)}onDeserialize(t){super.onDeserialize(t),this.removePlayerEntityID=t.readUint32()}};var ut=class extends o{constructor(t=0){super(),this.abilityContainerEntityID=t}getPacketID(){return n.C2S_InteractAbilityContainerRequestPacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=4,t}onSerialize(t){super.onSerialize(t),t.writeUint32(this.abilityContainerEntityID)}onDeserialize(t){super.onDeserialize(t),this.abilityContainerEntityID=t.readUint32()}};var ft=class extends o{constructor(t=0){super(),this.ownGold=t}getPacketID(){return n.S2C_InteractAbilityContainerResponsePacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=4,t}onSerialize(t){super.onSerialize(t),t.writeUint32(this.ownGold)}onDeserialize(t){super.onDeserialize(t),this.ownGold=t.readUint32()}};var ht=class extends o{constructor(t=0){super(),this.abilityEvolutionContainerEntityID=t}getPacketID(){return n.C2S_InteractAbilityEvolutionContainerRequestPacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=4,t}onSerialize(t){super.onSerialize(t),t.writeUint32(this.abilityEvolutionContainerEntityID)}onDeserialize(t){super.onDeserialize(t),this.abilityEvolutionContainerEntityID=t.readUint32()}};var ct=class extends o{constructor(t=0){super(),this.ownGold=t}getPacketID(){return n.S2C_InteractAbilityEvolutionContainerResponsePacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=4,t}onSerialize(t){super.onSerialize(t),t.writeUint32(this.ownGold)}onDeserialize(t){super.onDeserialize(t),this.ownGold=t.readUint32()}};var pt=class extends o{constructor(t=0,e=0){super(),this.entityID=t,this.abilityID=e}getPacketID(){return n.S2C_InformCharacterAbilityChangedPacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=4,t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint32(this.entityID),t.writeUint8(this.abilityID)}onDeserialize(t){super.onDeserialize(t),this.entityID=t.readUint32(),this.abilityID=t.readUint8()}};var mt=class extends o{constructor(t=y.ADD_WEIGHT){super(),this.statLevelUpType=t}getPacketID(){return n.C2S_CharacterStatLevelUpRequest}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.statLevelUpType)}onDeserialize(t){super.onDeserialize(t),this.statLevelUpType=t.readUint8()}};var Ft=class extends o{constructor(t,e){super(),this.addedBuff=e}getPacketID(){return n.S2C_AddBuffPacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=this.addedBuff.getFlexibleSize(),t}onSerialize(t){super.onSerialize(t),t.writeArrayBuffer(this.addedBuff.serialize())}onDeserialize(t){super.onDeserialize(t),this.addedBuff=new M().deserialize(t.readArrayBuffer())}};var It=class extends o{constructor(t,e){super(),this.removeBuffType=e}getPacketID(){return n.S2C_RemoveBuffPacket}getFlexibleSize(){let t=super.getFlexibleSize();return t+=1,t}onSerialize(t){super.onSerialize(t),t.writeUint8(this.removeBuffType)}onDeserialize(t){super.onDeserialize(t),this.removeBuffType=t.readUint8()}};var G=class extends D{constructor(){super(),this.precedingAbilityID="",this.abilityType=X.None}init(t,e){super.init(t,e),this.precedingAbilityID=this.getDictValue("PrecedingAbilityID",""),this.abilityType=X[this.getDictValue("AbilityType","None")]}static indexing(){for(let t of this.getAll().values()){(t.precedingAbilityID==null||t.precedingAbilityID=="")&&this._entryAbilityInfos.push(t);let e=this._trailingAbilityInfosMap.get(t.precedingAbilityID);e==null&&(e=[],this._trailingAbilityInfosMap.set(t.precedingAbilityID,e)),e.push(t)}}static getEntryAbilityInfos(){return this._entryAbilityInfos}static getTrailingAbilityInfos(t){return this._trailingAbilityInfosMap.get(t)}};z(G,"_entryAbilityInfos",[]),z(G,"_trailingAbilityInfosMap",new Map);var Ut=class extends D{constructor(){super(),this.level=0,this.requiredXP=0}init(t,e){super.init(t,e),this.level=this.getDictValueInt("Level",0),this.requiredXP=this.getDictValueInt("RequiredXP",0)}};var Pt=class extends D{constructor(){super(),this.price=0,this.ability={}}init(t,e){super.init(t,e),this.price=this.getDictValueInt("Price"),this.ability=this.getDictValue("Ability")}getAbilityValue(t,e=""){return this.ability[t]}getAbilityValueInt(t,e=0){let i=W(this.ability[t]);return Number.isFinite(i)?i:e}getAbilityValueFloat(t,e=0){let i=N(this.ability[t]);return Number.isFinite(i)?i:e}getAbilityValueBool(t,e=!1){let i=q(this.ability[t]);return i==null?e:!!i}};return qt(Kt);})();
//# sourceMappingURL=SharedBundle.js.map
