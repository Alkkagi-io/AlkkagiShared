var AlkkagiSharedBundle=(()=>{var F=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var X=(i,t,e)=>t in i?F(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Y=(i,t)=>{for(var e in t)F(i,e,{get:t[e],enumerable:!0})},Z=(i,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of K(t))!Q.call(i,o)&&o!==e&&F(i,o,{get:()=>t[o],enumerable:!(r=q(t,o))||r.enumerable});return i};var _=i=>Z(F({},"__esModule",{value:!0}),i);var E=(i,t,e)=>X(i,typeof t!="symbol"?t+"":t,e);var rt={};Y(rt,{BufferReadHandle:()=>g,BufferWriteHandle:()=>x,ELogLevel:()=>b,ELogMode:()=>m,EPacketID:()=>d,MessagePacket:()=>S,Packet:()=>a,PacketHandler:()=>y,PacketManager:()=>l,ResourceBase:()=>L,SerializableData:()=>c,Vector:()=>w,VectorPacket:()=>U,decodeUTF16LE:()=>C,decodeUTF8:()=>v,encodeUTF16LE:()=>N,encodeUTF8:()=>I,getBytesHeaderSize:()=>R,getFlexiableUTF16LESize:()=>tt,getFlexiableUTF8Size:()=>B,logger:()=>et,parseToBoolean:()=>A,parseToFloat:()=>z,parseToInteger:()=>T});function z(i){if(i==null)return null;let t=String(i).trim().replace(",","."),e=Number.parseFloat(t);return Number.isFinite(e)?e:null}function T(i){if(i==null)return null;let t=Number.parseInt(String(i).trim(),10);return Number.isFinite(t)?t:null}function A(i){if(i==null)return null;let t=String(i).trim().toLowerCase();return t==="true"||t==="1"?!0:t==="false"||t==="0"?!1:null}var L=class{constructor(){this.id=0,this.name="",this.dict={}}init(t,e){this.id=t,this.dict=e||{},this.name=this.getDictValue("Name","")}hasDict(t){return Object.prototype.hasOwnProperty.call(this.dict,t)}getDictValue(t,e=""){return this.dict[t]}getDictValueInt(t,e=0){let r=T(this.dict[t]);return Number.isFinite(r)?r:e}getDictValueFloat(t,e=0){let r=z(this.dict[t]);return Number.isFinite(r)?r:e}getDictValueBool(t,e=!1){let r=A(this.dict[t]);return r==null?e:!!r}getDictValueArray(t,e=[]){let r=this.dict[t];if(r==null)return e;if(Array.isArray(r))return r;if(typeof r=="string"){try{let s=JSON.parse(r);if(Array.isArray(s))return s}catch(s){}let o=r.split(",").map(s=>s.trim()).filter(s=>s.length>0);if(o.length>0)return o}return e}static _ensureStore(){Object.prototype.hasOwnProperty.call(this,"items")||Object.defineProperty(this,"items",{value:new Map,writable:!0,enumerable:!1,configurable:!0})}static get(t){return this._ensureStore(),this.items.get(t)}static getWhere(t){this._ensureStore();let e=[];for(let r of this.items.values())(!t||t(r))&&e.push(r);return e}static async load(t,e=!0){let r=this;r._ensureStore();let o;try{let s=t.charCodeAt(0)===65279?t.slice(1):t;o=JSON.parse(s)}catch(s){console.log(`[${r.name}] JSON parse error: ${fileName}`);return}e&&r.items.clear();for(let s in o){if(!Object.prototype.hasOwnProperty.call(o,s))continue;let n=Number.parseInt(s,10);if(!Number.isFinite(n))continue;let h=o[s],f=h;if(typeof h=="string")try{f=JSON.parse(h)}catch($){console.log(`[${r.name}] Skip id=${n} (inner JSON parse error)`);continue}if(!f||typeof f!="object"){console.log(`[${r.name}] Skip id=${n} (value is not an object)`);continue}let u=new r;u.init(n,f),r.items.set(n,u)}console.log(`[${r.name}] Loaded ${r.items.size} items from ${path.relative(baseDir,p)}.`)}};function I(i){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(i);let t=[];for(let e=0;e<i.length;e++){let r=i.charCodeAt(e);if(r>=55296&&r<=56319&&e+1<i.length){let o=i.charCodeAt(e+1);o>=56320&&o<=57343&&(r=65536+(r-55296<<10)+(o-56320),e++)}r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|r&63):r<=65535?t.push(224|r>>12,128|r>>6&63,128|r&63):t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}return Uint8Array.from(t)}function v(i){var e,r,o,s,n,h;if(typeof TextDecoder!="undefined")return new TextDecoder("utf-8").decode(i);let t="";for(let f=0;f<i.length;){let u=i[f++];if(u<128){t+=String.fromCharCode(u);continue}if((u&224)===192){let O=((e=i[f++])!=null?e:0)&63,D=(u&31)<<6|O;t+=String.fromCharCode(D);continue}if((u&240)===224){let O=((r=i[f++])!=null?r:0)&63,D=((o=i[f++])!=null?o:0)&63,W=(u&15)<<12|O<<6|D;t+=String.fromCharCode(W);continue}let $=((s=i[f++])!=null?s:0)&63,j=((n=i[f++])!=null?n:0)&63,G=((h=i[f++])!=null?h:0)&63,k=(u&7)<<18|$<<12|j<<6|G,J=55296+(k-65536>>10),H=56320+(k-65536&1023);t+=String.fromCharCode(J,H)}return t}function N(i,t=!1){let e=[];for(let n=0;n<i.length;n++){let h=i.charCodeAt(n);if(h>=55296&&h<=56319&&n+1<i.length){let f=i.charCodeAt(n+1);if(f>=56320&&f<=57343){e.push(h,f),n++;continue}}e.push(h)}let r=t?2:0,o=new Uint8Array(e.length*2+r),s=0;t&&(o[s++]=255,o[s++]=254);for(let n=0;n<e.length;n++){let h=e[n];o[s++]=h&255,o[s++]=h>>8}return o}function C(i){let t=0;i.length>=2&&i[0]===255&&i[1]===254&&(t=2);let e=32768,r=i.length-t>>>1,o="";for(let s=0;s<r;s+=e){let n=Math.min(e,r-s),h=new Array(n);for(let f=0;f<n;f++)h[f]=i[t+(s+f<<1)]|i[t+(s+f<<1)+1]<<8;o+=String.fromCharCode(...h)}return o}var g=class{constructor(t){this.buffer=t,this.view=new DataView(t),this.offset=0}readUint8(){if(this.offset+1>this.buffer.byteLength)throw new Error("Error with readUint8: Out of bounds");let t=this.view.getUint8(this.offset);return this.offset+=1,t}readUint16(){if(this.offset+2>this.buffer.byteLength)throw new Error("Error with readUint16: Out of bounds");let t=this.view.getUint16(this.offset,!0);return this.offset+=2,t}readUint32(){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with readUint32: Out of bounds");let t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}readInt8(){if(this.offset+1>this.buffer.byteLength)throw new Error("Error with readInt8: Out of bounds");let t=this.view.getInt8(this.offset);return this.offset+=1,t}readInt16(){if(this.offset+2>this.buffer.byteLength)throw new Error("Error with readInt16: Out of bounds");let t=this.view.getInt16(this.offset,!0);return this.offset+=2,t}readInt32(){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with readInt32: Out of bounds");let t=this.view.getInt32(this.offset,!0);return this.offset+=4,t}readFloat32(){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with readFloat32: Out of bounds");let t=this.view.getFloat32(this.offset,!0);return this.offset+=4,t}readFloat64(){if(this.offset+8>this.buffer.byteLength)throw new Error("Error with readFloat64: Out of bounds");let t=this.view.getFloat64(this.offset,!0);return this.offset+=8,t}readStringUTF8(){let t=this.readUint16();if(this.offset+t>this.buffer.byteLength)throw new Error("Error with readStringUTF8: Out of bounds");let e=new Uint8Array(this.buffer,this.offset,t),r=v(e);return this.offset+=t,r}readStringUTF16LE(){let t=this.readUint16();if(this.offset+t>this.buffer.byteLength)throw new Error("Error with readStringUTF16LE: Out of bounds");let e=new Uint8Array(this.buffer,this.offset,t),r=C(e);return this.offset+=t,r}readBytes(){return new Uint8Array(this.readArrayBuffer())}readArrayBuffer(){let t=this.readUint16();if(this.offset+t>this.buffer.byteLength)throw new Error("Error with readArrayBuffer: Out of bounds");let e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}},x=class{constructor(t){this.buffer=t,this.view=new DataView(t),this.offset=0}writeUint8(t){if(this.offset+1>this.buffer.byteLength)throw new Error("Error with writeUint8: Out of bounds");this.view.setUint8(this.offset,t),this.offset+=1}writeUint16(t){if(this.offset+2>this.buffer.byteLength)throw new Error("Error with writeUint16: Out of bounds");this.view.setUint16(this.offset,t,!0),this.offset+=2}writeUint32(t){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with writeUint32: Out of bounds");this.view.setUint32(this.offset,t,!0),this.offset+=4}writeInt8(t){if(this.offset+1>this.buffer.byteLength)throw new Error("Error with writeInt8: Out of bounds");this.view.setInt8(this.offset,t),this.offset+=1}writeInt16(t){if(this.offset+2>this.buffer.byteLength)throw new Error("Error with writeInt16: Out of bounds");this.view.setInt16(this.offset,t,!0),this.offset+=2}writeInt32(t){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with writeInt32: Out of bounds");this.view.setInt32(this.offset,t,!0),this.offset+=4}writeFloat32(t){if(this.offset+4>this.buffer.byteLength)throw new Error("Error with writeFloat32: Out of bounds");this.view.setFloat32(this.offset,t,!0),this.offset+=4}writeFloat64(t){if(this.offset+8>this.buffer.byteLength)throw new Error("Error with writeFloat64: Out of bounds");this.view.setFloat64(this.offset,t,!0),this.offset+=8}writeStringUTF8(t){let e=I(t),r=e.length;if(r>65535)throw new Error("Error with writeStringUTF8: Out of bounds");if(this.offset+2+r>this.buffer.byteLength)throw new Error("Error with writeStringUTF8: Out of bounds");this.writeUint16(r),new Uint8Array(this.buffer,this.offset,r).set(e),this.offset+=r}writeStringUTF16LE(t){let e=N(t,!1),r=e.length;if(r>65535)throw new Error("Error with writeStringUTF16LE: Out of bounds");if(this.offset+2+r>this.buffer.byteLength)throw new Error("Error with writeStringUTF16LE: Out of bounds");this.writeUint16(r),new Uint8Array(this.buffer,this.offset,r).set(e),this.offset+=r}writeBytes(t){let e=t.length;if(this.offset+e>this.buffer.byteLength)throw new Error("Error with writeBytes: Out of bounds");this.writeUint16(e),new Uint8Array(this.buffer,this.offset,e).set(t),this.offset+=e}writeArrayBuffer(t){let e=new Uint8Array(t);this.writeBytes(e)}build(){return this.buffer.slice(0,this.offset)}};function B(i){return 2+i.length*4}function tt(i){return 2+i.length*4}function R(){return 2}var V={ERROR:"\x1B[31m",WARN:"\x1B[33m",INFO:"\x1B[36m",DEBUG:"\x1B[90m",RESET:"\x1B[0m"},b={ERROR:0,WARN:1,INFO:2,DEBUG:3},m={DEVELOPMENT:"development",PRODUCTION:"production",MASTER:"master"},P={[m.DEVELOPMENT]:b.DEBUG,[m.PRODUCTION]:b.INFO,[m.MASTER]:b.ERROR},M=class{constructor(){this.currentLevel=P[m.DEVELOPMENT]}setMode(t){P.hasOwnProperty(t)!==!1&&(this.currentLevel=P[t])}getTimestamp(){return new Date().toISOString()}formatMessage(t,e,r){let o=this.getTimestamp(),s=V[t]||"",n=V.RESET;return`${s}[${o}] [${t}] [${e}] ${r}${n}`}log(t,e,r){b[t]>this.currentLevel||console.log(this.formatMessage(t,e,r))}error(t,e){this.log("ERROR",t,e)}warn(t,e){this.log("WARN",t,e)}info(t,e){this.log("INFO",t,e)}debug(t,e){this.log("DEBUG",t,e)}},et=new M;var c=class{constructor(){}getFlexiableSize(){throw new Error("Abstract method 'getFlexiableSize' must be implemented")}serialize(){let t=new ArrayBuffer(this.getFlexiableSize()),e=new x(t);return this.onSerialize(e),e.build()}onSerialize(t){throw new Error("Abstract method 'onSerialize' must be implemented")}deserialize(t){let e=new g(t);return this.onDeserialize(e),this}onDeserialize(t){throw new Error("Abstract method 'onDeserialize' must be implemented")}};var w=class i extends c{constructor(t=0,e=0){super(),this.x=t,this.y=e}getFlexiableSize(){let t=0;return t+=4,t+=4,t}onSerialize(t){t.writeFloat32(this.x),t.writeFloat32(this.y)}onDeserialize(t){this.x=t.readFloat32(),this.y=t.readFloat32()}getMagnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}getSqrMagnitude(){return this.x*this.x+this.y*this.y}getNormalized(){let t=this.getMagnitude();return t===0?new i(0,0):new i(this.x/t,this.y/t)}normalize(){let t=this.getMagnitude();t!==0&&(this.x/=t,this.y/=t)}getAdded(t){return new i(this.x+t.x,this.y+t.y)}add(t){this.x+=t.x,this.y+=t.y}getSubtracted(t){return new i(this.x-t.x,this.y-t.y)}subtract(t){this.x-=t.x,this.y-=t.y}getMultiplied(t){return new i(this.x*t,this.y*t)}multiply(t){this.x*=t,this.y*=t}getDivided(t){return new i(this.x/t,this.y/t)}divide(t){this.x/=t,this.y/=t}};var a=class extends c{constructor(){super()}getPacketID(){throw new Error("Abstract method 'getPacketID' must be implemented")}getFlexiableSize(){let t=0;return t+=1,t}onSerialize(t){t.writeUint8(this.getPacketID())}onDeserialize(t){t.readUint8()}};var y=class{constructor(){}handle(t){throw new Error("Abstract method 'handle' must be implemented")}};var l=class{constructor(){throw new Error("PacketManager is a static class and cannot be instantiated")}static on(t,e,r){this.factories[t]=e,this.handlers[t]=r}static createPacket(t,e){let r=this.factories[t];if(r===void 0)throw new Error(`Factory for packetID ${t} not found`);let o=new r;return o.deserialize(e),o}static createHandler(t,...e){let r=this.handlers[t];if(r===void 0)throw new Error(`Handler for packetID ${t} not found`);return new r(...this.handlerArgs,...e)}static injectHandlerArgs(...t){this.handlerArgs=t}};E(l,"factories",{}),E(l,"handlers",{}),E(l,"handlerArgs",[]);var d={MESSAGE:0,VECTOR:1};var S=class extends a{constructor(t=""){super(),this.message=t}getPacketID(){return d.MESSAGE}getFlexiableSize(){let t=super.getFlexiableSize();return t+=B(this.message),t}onSerialize(t){super.onSerialize(t),t.writeStringUTF8(this.message)}onDeserialize(t){super.onDeserialize(t),this.message=t.readStringUTF8()}};var U=class extends a{constructor(t=new w){super(),this.vector=t}getPacketID(){return d.VECTOR}getFlexiableSize(){let t=super.getFlexiableSize();return t+=this.vector.getFlexiableSize()+R(),t}onSerialize(t){super.onSerialize(t),t.writeArrayBuffer(this.vector.serialize())}onDeserialize(t){super.onDeserialize(t),this.vector=new w().deserialize(t.readArrayBuffer())}};return _(rt);})();
//# sourceMappingURL=SharedBundle.js.map
